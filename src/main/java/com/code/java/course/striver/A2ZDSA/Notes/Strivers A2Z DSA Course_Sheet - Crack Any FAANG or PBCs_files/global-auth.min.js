const __global_state={isLoggedIn:!1,isModalOpened:!1,user:{name:"",email:""},currentTopic:null,currentCell:null,gAuthContext:"signin",isTestingEnv:"true"===new URLSearchParams(window.location.search).get("testing")},baseUrl=__global_state.isTestingEnv?"http://localhost:5000":"https://api.takeuforward.org",openAuthModal=()=>{const a=document.querySelector(".auth-modal");document.body.style.overflow="hidden",a.querySelectorAll("form").forEach(a=>a.reset()),a.classList.add("show"),__global_state.isModalOpened=!0};window.addEventListener("load",()=>{const a=localStorage.getItem("__is_logged_in");__global_state.isLoggedIn=!!a&&!!JSON.parse(a);const b=localStorage.getItem("__user_obj");b&&(__global_state.user=JSON.parse(b));try{const a=document.querySelector("button.primary-menu-toggle.menu-toggle"),b=document.querySelector("nav#site-navigation"),c=document.querySelector("nav.main-navigation");if(a&&a.addEventListener("click",()=>{b.classList.toggle("toggled-on");const c="true"===a.ariaExpanded;a.ariaExpanded=c?"false":"true"}),c){const a=c.querySelectorAll("button");a.forEach(a=>{a.addEventListener("click",()=>{a.classList.toggle("toggled-on");const b=a.nextElementSibling;b.classList.toggle("toggled-on"),b.setAttribute("aria-expanded",b.classList.contains("toggled-on")?"true":"false"),b.querySelector(".screen-reader-text").textContent=b.classList.contains("toggled-on")?maxwellScreenReaderText.collapse:maxwellScreenReaderText.expand,b.nextElementSibling.classList.toggle("toggled-on")})})}}catch(a){console.error(a)}const c=document.querySelector(".header__content--auth");c&&c.classList.remove("hide");const d=document.querySelector(".logout-button"),e=document.querySelector(".auth-button"),f=document.querySelector(".auth-button a"),g=document.querySelector(".auth-modal");if(e&&g){const a=g.querySelector("button.auth__close"),b=g.querySelector("#login-form"),c=g.querySelector("#signup-form"),h=a=>{const b=g.querySelector(".auth.login"),c=g.querySelector(".auth.signup");switch(a){case"signup":{b.classList.add("hide"),c.classList.remove("hide");break}case"login":{b.classList.remove("hide"),c.classList.add("hide");break}}};if(b){const a=b.querySelector(".auth__form--error p"),c=a=>{localStorage.setItem("__is_logged_in","1"),localStorage.setItem("__user_obj",JSON.stringify(a)),window.location.reload()},d=b=>{a.textContent=b};b.addEventListener("submit",async a=>{a.preventDefault();try{const a={email:"",password:""},e=b.querySelector(`input[name="email"]`);e&&(a.email=e.value);const f=b.querySelector(`input[name="password"]`);f&&(a.password=f.value);const g=await fetch(`${baseUrl}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"}),h=await g.json();h.status?c(h.data):d(h.msg)}catch(a){console.error(a),d(a.message)}});const e=document.getElementById("signup-switch");e&&e.addEventListener("click",()=>{h("signup")})}if(c){const a=c.querySelector(".auth__form--error p"),b=a=>{localStorage.setItem("__is_logged_in","1"),localStorage.setItem("__user_obj",JSON.stringify(a)),window.location.reload()},d=b=>{a.textContent=b};c.addEventListener("submit",async e=>{e.preventDefault();try{const e={name:"",email:"",password:"",college:""},f=c.querySelector(`input[name="full-name"]`);f&&(e.name=f.value);const g=c.querySelector(`input[name="email"]`);g&&(e.email=g.value);const h=c.querySelector(`input[name="phone"]`);h&&h.value&&(e.mobile=h.value);const i=c.querySelector(`input[name="college"]`);i&&(e.college=i.value);const j=c.querySelector(`input[name="grdt_yr"]`);j&&j.value&&(e.grdt_yr=j.valueAsNumber);const k=c.querySelector(`input[name="password"]`);k&&(e.password=k.value);const l=c.querySelector(`input[name="c-password"]`);if(l){const b=l.value;if(b!==k.value)return void(a.textContent="Passwords do no match.")}const m=await fetch(`${baseUrl}/api/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}),n=await m.json();n.status?b(n.data):d(n.msg)}catch(a){console.error(a),d(a.message)}});const e=document.getElementById("login-switch");e&&e.addEventListener("click",()=>{h("login")})}if(__global_state.isLoggedIn){document.getElementById("login-signup").classList.add("hide");const{name:a}=__global_state.user;f.textContent=`Hello, ${a.split(" ")[0]}`,d&&d.classList.remove("hide")}e.addEventListener("click",a=>{a.preventDefault(),__global_state.isModalOpened||a.stopPropagation(),__global_state.isLoggedIn||openAuthModal()}),a.addEventListener("click",()=>{document.body.style.overflow="",g.classList.remove("show")});{const a=window.google;a.accounts.id.initialize({client_id:"886155749164-f2c436pqqnamec1klf6pgt0dtob31ldh.apps.googleusercontent.com",callback:async function(a){try{const b=await fetch(`${baseUrl}/api/auth/google-auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credentials:a.credential}),credentials:"include"}),c=await b.json();if(b.ok&&c.status)localStorage.setItem("__is_logged_in","1"),localStorage.setItem("__user_obj",JSON.stringify(c.data)),window.location.reload();else throw alert(c),new Error(c.msg)}catch(a){console.error(a);let d=c.querySelector(".auth__form--error p");d.textContent=a.message,d=b.querySelector(".auth__form--error p"),d.textContent=a.message}},context:"signin"}),a.accounts.id.renderButton(b.querySelector(".auth__form--google"),{text:"signin_with"}),a.accounts.id.renderButton(c.querySelector(".auth__form--google"),{text:"signup_with"})}}d&&d.addEventListener("click",async()=>{try{const a=await fetch(`${baseUrl}/api/auth/logout`,{credentials:"include"}),b=await a.json();b.status&&(window.google&&window.google.accounts.id.disableAutoSelect(),localStorage.removeItem("__is_logged_in"),localStorage.removeItem("__user_ob"),window.location.reload())}catch(a){console.error(a)}})});